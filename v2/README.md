made some changes to try and improve performance
